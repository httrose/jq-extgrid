/*!artTemplate - Template Engine*/var template=function(a,b){return template["object"==typeof b?"render":"compile"].apply(template,arguments)};(function(a,b){"use strict";a.version="2.0.1",a.openTag="<%",a.closeTag="%>",a.isEscape=!0,a.isCompress=!1,a.parser=null,a.render=function(a,b){var c=d(a);return void 0===c?e({id:a,name:"Render Error",message:"No Template"}):c(b)},a.compile=function(b,d){function l(c){try{return new j(c)+""}catch(f){return h?(f.id=b||d,f.name="Render Error",f.source=d,e(f)):a.compile(b,d,!0)(c)}}var g=arguments,h=g[2],i="anonymous";"string"!=typeof d&&(h=g[1],d=g[0],b=i);try{var j=f(d,h)}catch(k){return k.id=b||d,k.name="Syntax Error",e(k)}return l.prototype=j.prototype,l.toString=function(){return""+j},b!==i&&(c[b]=l),l},a.helper=function(b,c){a.prototype[b]=c},a.onerror=function(a){var c="[template]:\n"+a.id+"\n\n[name]:\n"+a.name;a.message&&(c+="\n\n[message]:\n"+a.message),a.line&&(c+="\n\n[line]:\n"+a.line,c+="\n\n[source]:\n"+a.source.split(/\n/)[a.line-1].replace(/^[\s\t]+/,"")),a.temp&&(c+="\n\n[temp]:\n"+a.temp),b.console&&console.error(c)};var c={},d=function(d){var e=c[d];if(void 0===e&&"document"in b){var f=document.getElementById(d);if(f){var g=f.value||f.innerHTML;return a.compile(d,g.replace(/^\s*|\s*$/g,""))}}else if(c.hasOwnProperty(d))return e},e=function(b){function c(){return c+""}return a.onerror(b),c.toString=function(){return"{Template Error}"},c},f=function(){a.prototype={$render:a.render,$escape:function(a){return"string"==typeof a?a.replace(/&(?![\w#]+;)|[<>"']/g,function(a){return{"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"}[a]}):a},$string:function(a){return"string"==typeof a||"number"==typeof a?a:"function"==typeof a?a():""}};var b=Array.prototype.forEach||function(a,b){for(var c=this.length>>>0,d=0;c>d;d++)d in this&&a.call(b,this[d],d,this)},c=function(a,c){b.call(a,c)},d="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",e=/\/\*(?:.|\n)*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|'[^']*'|"[^"]*"|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,f=/[^\w$]+/g,g=RegExp(["\\b"+d.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),h=/\b\d[^,]*/g,i=/^,+|,+$/g,j=function(a){return a=a.replace(e,"").replace(f,",").replace(g,"").replace(h,"").replace(i,""),a=a?a.split(/,+/):[]};return function(b,d){function w(b){return k+=b.split(/\n/).length-1,a.isCompress&&(b=b.replace(/[\n\r\t\s]+/g," ")),b=b.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),b=q[1]+"'"+b+"'"+q[2],b+"\n"}function x(b){var c=k;if(g?b=g(b):d&&(b=b.replace(/\n/g,function(){return k++,"$line="+k+";"})),0===b.indexOf("=")){var e=0!==b.indexOf("==");if(b=b.replace(/^=*|[\s;]*$/g,""),e&&a.isEscape){var f=b.replace(/\s*\([^\)]+\)/,"");m.hasOwnProperty(f)||/^(include|print)$/.test(f)||(b="$escape($string("+b+"))")}else b="$string("+b+")";b=q[1]+b+q[2]}return d&&(b="$line="+c+";"+b),y(b),b+"\n"}function y(a){a=j(a),c(a,function(a){l.hasOwnProperty(a)||(z(a),l[a]=!0)})}function z(a){var b;"print"===a?b=s:"include"===a?(n.$render=m.$render,b=t):(b="$data."+a,m.hasOwnProperty(a)&&(n[a]=m[a],b=0===a.indexOf("$")?"$helpers."+a:b+"===undefined?$helpers."+a+":"+b)),o+=a+"="+b+","}var e=a.openTag,f=a.closeTag,g=a.parser,h=b,i="",k=1,l={$data:!0,$helpers:!0,$out:!0,$line:!0},m=a.prototype,n={},o="var $helpers=this,"+(d?"$line=0,":""),p="".trim,q=p?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],r=p?"if(content!==undefined){$out+=content;return content}":"$out.push(content);",s="function(content){"+r+"}",t="function(id,data){if(data===undefined){data=$data}var content=$helpers.$render(id,data);"+r+"}";c(h.split(e),function(a){a=a.split(f);var c=a[0],d=a[1];1===a.length?i+=w(c):(i+=x(c),d&&(i+=w(d)))}),h=i,d&&(h="try{"+h+"}catch(e){"+"e.line=$line;"+"throw e"+"}"),h="'use strict';"+o+q[0]+h+"return new String("+q[3]+")";try{var u=Function("$data",h);return u.prototype=n,u}catch(v){throw v.temp="function anonymous($data) {"+h+"}",v}}}()})(template,this),"function"==typeof define?define(function(a,b,c){c.exports=template}):"undefined"!=typeof exports&&(module.exports=template);
/*
extgrid
http://www.extgrid.com/
*/
(function($){"use strict";$.dataGrid=function(e){this.init(e)},$.extGrid=$.dataGrid,$.dataGrid.fn={},$.dataGrid.fn.extend=function(e){$.extend($.dataGrid.prototype,e)},$.dataGrid.extend=function(e){$.extend($.dataGrid,e)},$.dataGrid.extend({version:"1.0",padding:8,getDefaults:function(e){var t={self:null,init:$.noop,title:"",iconCls:"",toolBars:!1,_toolItem:{text:"",cls:"",callBack:$.noop,disabled:!1},ltText:"",rowNumbersWidth:!1,rowNumbersExpand:!1,rowNumbers2Row:!0,rowTpl:"",headerTpl:"",containerCss:"datagrid-container-border",border:!0,leftBorder:1,rightBorder:1,topBorder:1,bottomBorder:1,padding:$.dataGrid.padding,width:700,height:250,checkBox:!1,checkBoxWidth:"20px",checkBoxTitle:'<input type="checkbox">',checkBoxFit:!1,editColumn:!1,editColumnTitle:"操作",editColumnFit:!0,editCellW:60,columns:[],moveColumnTm:500,moveColumns:!0,_columnMetaData:{field:"",title:"",width:"120px",align:"left",_expand:!1,callBack:$.noop,hcls:"",bcls:"",fcls:"",sortable:!1,textLimit:!1,fitColumn:!0,disabled:!1},textLimit:!1,textLimitDef:"...",groupBy:!1,groupList:!1,groupListCallBack:$.noop,_groupListData:[],_sTop:0,_sLeft:0,_lTime:50,_lSize:50,fitColumns:!0,data:[],pk:"",lockRows:[],lockColumns:[],hideColumns:[],selectRows:[],isCreate:!1,isShow:!1,views:{},method:"post",url:"",loadMsg:"加载中,请稍后...",cache:!0,cacheData:[],pagination:!1,pagerToolBar:!1,pagerMsg:"当前显示 {start} 到 {end} 条，共 {total} 条",pageNumber:1,pageSize:10,dataType:"json",pageList:[10,20,30,40,50],queryParams:{},singleSelect:!1,sortName:"",sortOrder:"asc",rowStyler:"",rowCallBack:$.noop,tpl:{},methodCall:{},template:template,isEscape:!1,noop:$.noop,events:{onStart:$.noop,onFinish:$.noop,onBeforeLoad:$.noop,onLoadSuccess:$.noop,onLoadError:$.noop,onClickRow:$.noop,onColumnOver:$.noop,onColumnOut:$.noop,onOverRow:$.noop,onOutRow:$.noop,onDblClickRow:$.noop,onClickCell:$.noop,onDblClickCell:$.noop,onSortColumn:$.noop,onResizeColumnStart:$.noop,onResizeColumn:$.noop,onResizeColumnStop:$.noop,onSelect:$.noop,onUnselect:$.noop,onSelectAll:$.noop,onUnselectAll:$.noop,onHeaderContextMenu:$.noop,onHeaderCreate:$.noop,onToolBarCreate:$.noop,onRowContextMenu:$.noop,onBeforeRefresh:$.noop,onRefresh:$.noop,onChangePageSize:$.noop,onShowGriding:$.noop,onShowGrid:$.noop,onBeforeShowGrid:$.noop,onGetData:$.noop,onPagerCreate:$.noop,onSelectPage:$.noop,onClickRowNumber:$.noop,onSearch:$.noop,onExpandRow:$.noop,onLockColumn:$.noop,onBeforeLockColumn:$.noop,onAfterLockColumn:$.noop,onLockRow:$.noop,onBeforeLockRow:$.noop,onAfterLockRow:$.noop,onUnlockColumn:$.noop,onUnlockRow:$.noop,onViewSizeChange:$.noop,onSizeChange:$.noop,onScroll:$.noop,onDataChange:$.noop,onCellEdit:$.noop,onAdd:$.noop,onUpdate:$.noop,onDelete:$.noop,onAjaxAdd:$.noop,onAjaxUpdate:$.noop,onAjaxDelete:$.noop,onColumnMove:$.noop,onColumnMoving:$.noop}};return $.extend(t,e)},getToGridOptions:function(e){var t={options_from:"data-options",columns_from:"thead th",data_from:"tbody tr"};return $.extend(!0,t,e)},_undef:function(e,t){return e===undefined?t:e},_Tpl:{container:'<div class="datagrid-container <%=(border?containerCss:"")%>" id="<%=id%>" style=" position:relative; overflow:hidden; width:<%=width%>px; height:<%=height%>px;"></div>',title:'<div class="datagrid-title <%=iconCls%>" id="title_<%=id%>"><%=title%></div>',toolbar:'<div class="datagrid-toolbar" id="toolbar_<%=id%>"></div>',grid:'<div class="datagrid-view" id="view_<%=id%>" style="width:<%=width%>px; height:0px;"></div>',group_row:'<tr id="<%=id%>-group-row-<%=gid%>"  datagrid-group-row-id="<%=gid%>" class="datagrid-group-row"><td style="width:<%=w%>px" colspan="<%=colspan%>"><div  class="datagrid-group-cell"><%=html%>(<%=num%>)</div></td></tr>',view1:'<div class="datagrid-view1" id="view1_<%=id%>" style="width:<%=parseFloat(rowNumbersWidth)%>px;height:100%;"><div  class="datagrid-header" id="view1-datagrid-header-<%=id%>" style="width: 100%; z-index:40; position:relative;"><div class="datagrid-header-inner" id="view1-datagrid-header-inner-<%=id%>"><div class="datagrid-header-inner-wraper"><table class="datagrid-htable" id="view1-datagrid-header-inner-htable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-inner-htable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-header-outer" id="view1-datagrid-header-outer-<%=id%>"><div class="datagrid-header-outer-wraper"><table class="datagrid-locktable" id="view1-datagrid-header-outer-locktable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view1-datagrid-header-outer-locktable-tbody-<%=id%>"></tbody></table></div></div></div><div class="datagrid-body-wrap" id="view1-datagrid-body-wrap-<%=id%>" style="width: 100%; height:0px; overflow:hidden;zoom:1; "><div class="datagrid-body" id="view1-datagrid-body-<%=id%>" style="width: 100%;float:left;z-index:30;position:relative;"><table class="datagrid-btable" id="view1-datagrid-body-btable-<%=id%>" cellspacing="0" cellpadding="0" border="0"><tbody id="view1-datagrid-body-btable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-footer" id="view1-datagrid-footer-<%=id%>" style="width: 100%; height:0px; overflow:hidden;position:relative;z-index:31;"></div></div>',view2:'<div class="datagrid-view2" id="view2_<%=id%>" style="width:0px;height:100%;"><div  class="datagrid-header" id="view2-datagrid-header-<%=id%>" style="width: 100%;"><div class="datagrid-header-inner" id="view2-datagrid-header-inner-<%=id%>"><div class="datagrid-header-inner-wraper"><table class="datagrid-htable" id="view2-datagrid-header-inner-htable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-inner-htable-tbody-<%=id%>"></tbody></table></div></div><div class="datagrid-header-outer" id="view2-datagrid-header-outer-<%=id%>"><div class="datagrid-header-outer-wraper"><table class="datagrid-locktable" id="view2-datagrid-header-outer-locktable-<%=id%>" border="0" cellspacing="0" cellpadding="0"><tbody id="view2-datagrid-header-outer-locktable-tbody-<%=id%>"></tbody></table></div></div></div><div class="datagrid-body" id="view2-datagrid-body-<%=id%>" style="width: 100%;height:0px;"><table class="datagrid-btable" id="view2-datagrid-body-btable-<%=id%>" cellspacing="0" cellpadding="0" border="0"><tbody id="view2-datagrid-body-btable-tbody-<%=id%>"></tbody></table></div><div class="datagrid-footer" id="view2-datagrid-footer-<%=id%>" style="width: 100%; height:0px; overflow:hidden;"></div></div>',pager:'<div class="datagrid-pager pagination"> <table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><select class="pagination-page-list"><% var s = ""; for(var i=0;i<pageList.length;i++) {%><% if(pageList[i] == pageSize) {%><% s="selected";%><% } else {s="";} %><option value="<%=pageList[i]%>" <%=s%> ><%=pageList[i]%></option><% } %></select></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class=" p-plain <%=(pageNumber <= 1 )?"p-btn-disabled":""%>"><span class="pagination-first  p-btn">&nbsp;</span></a></td><td><a href="javascript:void(0)" class=" p-plain <%=(pageNumber <= 1 )?"p-btn-disabled":""%>"><span class="pagination-prev  p-btn">&nbsp;</span></a></td><td><div class="pagination-btn-separator"></div></td><td><span style="padding-left:6px;">第</span></td><td><input class="pagination-num" type="text" value="<%=pageNumber%>" size="2"></td><td><span style="padding-right:6px;">页 共 <%=pages%> 页</span></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class=" p-plain <%=(pageNumber >= pages)?"p-btn-disabled":""%>"><span class="pagination-next p-btn">&nbsp;</span></a></td><td><a href="javascript:void(0)" class=" p-plain <%=(pageNumber >= pages)?"p-btn-disabled":""%>"><span class="pagination-last p-btn ">&nbsp;</span></a></td><td><div class="pagination-btn-separator"></div></td><td><a href="javascript:void(0)" class=" p-plain"><span class="pagination-load p-btn">&nbsp;</span></a></td><td id="pagination-toolbar-<%=id%>"></td></tr></tbody></table><div class="pagination-info"><%=pagerMsg%></div><div style="clear:both;"></div></div>',view1_header_inner_row:'<tr class="datagrid-header-row"><td align="center" class="datagrid-td-rownumber" style=""><div class="datagrid-header-rownumber" style="width:<%=parseFloat(rowNumbersWidth)%>px;"><%=ltText%></div></td></tr>',view1_header_outer_row:"",view2_header_inner_row:'<tr class="datagrid-header-row"><% for(var i in fields) {%><td field="<%=fields[i]["field"]%>" align="<%=fields[i]["align"]%>"><div class="datagrid-header-wrap" field="<%=fields[i]["field"]%>" ><div class="datagrid-cell <%=fields[i]["hcls"]%>"  style="width:<%=fields[i]["width"]%>"><span><%=fields[i]["title"]%></span><span class="datagrid-sort-icon">&nbsp;</span></div></div></td><% } %></tr>',view2_header_outer_row:"",view1_row:'<tr id="<%=id%>-view1-row-<%=i%>" <%=( typeof data["_groupid_"] != "undefined" ) ? "datagrid-group-id="+data["_groupid_"] : ""%> datagrid-row-index="<%=i%>" datagrid-row-select="0" class="datagrid-row datagrid-row-view1 <%=((i+1)%2 ? "datagrid-row-view1-single" : "datagrid-row-view1-double")%>"><td align="center" class="datagrid-td-rownumber"><div class="datagrid-cell-rownumber" style="width:<%=parseFloat(rowNumbersWidth)%>px;"><%var j = i%><%=(rowNumbersExpand === false ? ++j : opt.self.tpl(rowNumbersExpand,data))%></div></td></tr>',view2_row:'<tr id="<%=id%>-row-<%=i%>" <%=( typeof data["_groupid_"] != "undefined" )? "datagrid-group-id="+data["_groupid_"] : ""%> datagrid-row-index="<%=i%>" datagrid-row-select="0" class="datagrid-row <%=((i+1)%2 ? "datagrid-row-single" : "datagrid-row-double")%>"><% for(var j in fields) {%><% var field = fields[j]["field"];%><td field="<%=fields[j]["field"]%>" align="<%=fields[j]["align"]%>"><div class="datagrid-cell datagrid-cell-c1-<%=fields[j]["field"]%> <%=fields[j]["bcls"]%>" style="width:<%=fields[j]["width"]%>;" ><%=fields[j]["_expand"] !== false ? opt.self.tpl(fields[j]["_expand"],data) : data[field]%></div></td><% } %></tr>'}}),$.dataGrid.fn.extend({init:function(e){var t=this;t.initEvents(e),t.configs=$.extend({},$.dataGrid.getDefaults(),e);var n=t.configs;n.self=t,n.template.isEscape=n.isEscape,n.template.helper("parseInt",parseInt),n.template.helper("parseFloat",parseFloat),n.border&&(n.width-=n.leftBorder+n.rightBorder,n.height-=n.topBorder+n.bottomBorder),n.id=n.id||t.getId(),n.gid=n.gid||"#view_"+n.id,n.rowNumbersWidth=parseFloat(n.rowNumbersWidth)>=0?n.rowNumbersWidth:!1,n.rowNumbersWidth===!1&&(n.rowNumbersWidth=n.groupBy==0?!1:"0px"),n.rowNumbersWidth===!1&&(n.rowNumbersWidth=n.lockColumns.length?"0px":!1);for(var r in n.columns)n.columns[r].width&&(n.columns[r].width=parseFloat(n.columns[r].width)-n.padding);n.init.call(t,n),t.sysEvents(),t.fireEvent("onStart",t,[n]),t.setContainer().setTitle().setToolBar().setGrid().setPager(!0).show()},inArray:function(e,t){if(t){var n=t.length,r=0;for(;r<n;r++)if(r in t&&t[r]==e)return r}return-1},tpl:function(e,t){var n=this,r=n.configs,i=r.template.compile(e);return i(t)},bind:function(e,t){if(typeof e=="undefined")return this;var t=t||$.noop,n=this,r=n.configs.events;r[e]=$.dataGrid._undef(r[e],[]),$.isFunction(r[e])&&(r[e]=[]);var i=r[e].push(t);return i-1},unbind:function(e,t){var n=this,r=n.configs.events,t=$.dataGrid._undef(t,!1);return t===!1?r[e]=$.noop:r[e][t]=$.noop,n},fireEvent:function(e,t,n){var r=this,i=r.configs.events[e],t=$.dataGrid._undef(t,r),n=$.dataGrid._undef(n,[]),s=!0;if($.isArray(i))for(var o=0;o<i.length;o++){s=i[o].apply(t,n);if(s===!1)break}else $.isFunction(i)&&(s=i.apply(t,n));return s},initEvents:function(e){var t=this,n=e.events?e.events:{};if($.isPlainObject(n)&&!$.isEmptyObject(n))for(var r in n)$.isFunction(n[r])&&n[r]!==$.noop&&(n[r]=[n[r]])},sysEvents:function(){var e=this,t=e.configs;e.bind("onShowGrid",e.autoExpand),e.bind("onClickRow",e.setExpandEvent),e.bind("onUnselectAll",function(){this.checkCk(!1)}),e.bind("onSelectAll",function(){this.checkCk(!0)}),e.bind("onUnselect",function(){this.checkCk(!1)}),e.bind("onShowGrid",function(){this.checkCk(!1)}),e.bind("onLoadSuccess",e.onLoadSuccess),e.bind("onLoadError",e.onLoadError),e.bind("onSetPk",e.setPk),e.bind("onViewSizeChange",e.onViewSizeChange),e.bind("onSizeChange",e.onSizeChange),e.bind("onShowGrid",e.onLockRow),e.bind("onShowGrid",e.onLockColumn),e.bind("onBeforeShowGrid",e.onBeforeShowGrid),e.bind("onScroll",e.onScroll),e.bind("onAfterLockRow",e.onAfterLockRow),e.bind("onAfterLockColumn",e.onAfterLockColumn),e.bind("onDataChange",e.onDataChange),e.bind("onOverRow",e.onOverRow),e.bind("onOutRow",e.onOutRow),e.bind("onShowGrid",e.onDisplayField),e.bind("onHeaderCreate",e.onHeaderCreate),e.bind("onColumnMove",e.onColumnMove),e.bind("onSelect",e.addSelectRecode),e.bind("onUnselect",e.removeSelectRecode)},getId:function(){return"datagrid_"+Math.floor(Math.random()*99999)},unique:function(){return"unique_"+Math.floor(Math.random()*99999)},showLoading:function(e,t){var n=this,r=n.configs,e=typeof e=="undefined"?r.loadMsg:e,t=t||"#"+r.id;n.hideLoading(t),$('<div class="datagrid-mask" style="display:block"></div><div class="datagrid-mask-msg" style="display: block; left: 50%;">'+e+"</div>").appendTo(t);var i=$(t).find("> .datagrid-mask-msg").outerWidth(!0);$(t).find(">.datagrid-mask-msg").css("marginLeft",-i/2+"px"),$(t).find(">.datagrid-mask").click(function(e){return!1})},hideLoading:function(e){var t=this,n=t.configs,e=e||"#view_"+n.id;$("#"+n.id).find(".datagrid-mask-msg,.datagrid-mask").remove()},methodCall:function(e){var e=e||"",t=this,n=t.configs;return e!=""&&e in n.methodCall&&$.isFunction(n.methodCall[e])&&n.methodCall[e].call(t),t},getColumnData:function(e,t,n){var r=this,i=r.configs,e=$.dataGrid._undef(e,!1),t=$.dataGrid._undef(t,!1);if(e===!1)return r;var s=r.getColumns(!0);for(var o in s)if(s[o]["field"]==e)return t===!1?s[o]:typeof n=="undefined"?s[o][t]:(s[o][t]=n,i.columns=s,r.setGridHeader(),r.refreshDataCache(),r);return null},setColumnData:function(e,t,n){var r=this;return r.getColumnData(e,t,n)},getData:function(){var e=this,t=e.configs,n=e.getAsync();return n?t.cacheData.source:t.data},textLimit:function(e,t,n){var r=this,i=r.configs,e=$.dataGrid._undef(e,"");if(e=="")return e;e=new String(e);var s=$("<div style='position:absolute;left:-1000px;'></div>");s.appendTo(document.body),s.css({fontSize:n});var o=e.length,u="",a=0;for(var f=1;f<=o;f++){u=e.substr(0,f),s.html(u+i.textLimitDef);if(!(parseFloat(s.width())<parseFloat(t)))break;a=f}return s.remove(),a==0?e.substr(0,1)+i.textLimitDef:a==o?e:e.substr(0,a)+i.textLimitDef},getTpl:function(e){var e=e||"",t=this,n=t.configs;template.isEscape=n.isEscape;var r=e in n.tpl?$(n.tpl[e]).html():$.dataGrid._Tpl[e];return r=r==""?$.dataGrid._Tpl[e]:r,r},setContainer:function(e){var e=e||{},t=this,e=t.configs,n=t.tpl(t.getTpl("container"),e);return e.helper.html(n),t},setTitle:function(e){var t=this,n=t.configs;n.title=typeof e=="undefined"?n.title:e;if(n.title=="")return t;var r=t.tpl(t.getTpl("title"),n);return t.configs.views.title=$(r),t},getTools:function(e){var t=this,n=t.configs;if($.isPlainObject(e))var e=[e];if(!$.isArray(e)&&!$.isPlainObject(e))return $(e);var r=n._toolItem,i='<table cellspacing="0" cellpadding="0" border="0"><tbody><tr>{$tools}</tr></tbody></table>',s="";for(var o in e)if($.isPlainObject(e[o])){e[o]=$.extend({},r,e[o]),e[o]["cls"]!=""&&(e[o].cls+=" l-btn-icon-left");var u=e[o].disabled?"l-btn-disabled":"";s+='<td><a href="javascript:void(0)" class="l-btn l-btn-plain '+u+'" indexid="'+o+'"><span class="l-btn-left"><span class="l-btn-text '+e[o].cls+'">'+e[o].text+"</span></span></a></td>"}else e[o]=="|"||e[o]=="-"||e[o]==";"||e[o]==","?s+='<td><div class="datagrid-btn-separator"></div></td>':s+="<td>"+e[o]+"</td>";i=i.replace("{$tools}",s);var i=$(i);return i.find(".l-btn").each(function(n){$(this).click(function(n){var r=$(this).attr("indexid");e[r].callBack.call(t,this,e[r]),n.stopPropagation(),n.preventDefault()})}),i},setToolBar:function(){var e=this,t=e.configs;if(t.toolBars===!1)return e;var n=e.tpl(e.getTpl("toolbar"),t);e.configs.views.toolbar=$(n);var r=e.getTools(t.toolBars);return r!==!1&&e.configs.views.toolbar.append(r),e.fireEvent("onToolBarCreate",e,[e.configs.views.toolbar,t.toolBars]),e.methodCall("setToolBar"),e},setGrid:function(){var e=this,t=e.configs,n=t.views;if(!n.grid){var r=e.tpl(e.getTpl("grid"),t);e.configs.views.grid=$(r)}else{var i=n.grid,s=0;for(var o in n){if(o=="grid")continue;s+=n[o].outerHeight(!0)}i.height(t.height-s)}return e.methodCall("setGrid"),e},autoExpand:function(){var e=this,t=e.configs;for(var n in t.data)"_expand"in t.data[n]&&"_openExpand"in t.data[n]&&t.data[n]._openExpand&&e.expandRow(n,t.data[n]._expand)},checkCk:function(e){var t=this,n=t.configs,r=n.gid,i=r,e=$.dataGrid._undef(e,!1);$("#view2-datagrid-header-inner-htable-tbody-"+n.id).find(">.datagrid-header-row td[field='ck']").find("input:checkbox").each(function(t){this.checked=e?!0:!1})},setExpandEvent:function(e,t,n){var r=this,i=r.configs;"_expand"in n&&(r.isExpandRowShow(t)?r.hideExpandRow(t):r.expandRow(t,n._expand))},addPagerEvent:function(){var e=this,t=e.configs,n=t.views.pager;return n.find(".pagination-first").click(function(){if($(this).parent().hasClass("p-btn-disabled"))return;t.pageNumber=1,e.refreshData()}),n.find(".pagination-prev").click(function(){if($(this).parent().hasClass("p-btn-disabled"))return;var n=t.pageNumber-1;t.pageNumber=n<0?1:n,e.refreshData()}),n.find(".pagination-next").click(function(){if($(this).parent().hasClass("p-btn-disabled"))return;var n=t.total||t.data.length,r=Math.ceil(parseInt(n)/parseInt(t.pageSize)),i=t.pageNumber+1;t.pageNumber=i>r?r:i,e.refreshData()}),n.find(".pagination-last").click(function(){if($(this).parent().hasClass("p-btn-disabled"))return;var n=t.total||t.data.length,r=Math.ceil(parseInt(n)/parseInt(t.pageSize));t.pageNumber=r,e.refreshData()}),n.find(".pagination-load").click(function(){if($(this).parent().hasClass("p-btn-disabled"))return;e.refreshData()}),n.find(".pagination-page-list").change(function(){var n=$(this).val(),r=e.fireEvent("onChangePageSize",e,[n]);if(r===!1)return!1;t.pageSize=n;var r=e.fireEvent("onSelectPage",e,[n]);if(r===!1)return!1;e.refreshData()}),n.find(".pagination-num").keydown(function(r){r.keyCode===13&&(t.pageNumber=n.find(".pagination-num").val(),e.refreshData())}),e},setPager:function(e){var t=this,n=t.configs,e=$.dataGrid._undef(e,!1);if(!n.pagination)return t;var r={};r.id=n.id,r.total=n.total||n.data.length,r.pageSize=n.pageSize,r.pageNumber=n.pageNumber,r.pageList=n.pageList,r.pages=Math.ceil(parseInt(r.total)/parseInt(r.pageSize)),n.pageNumber=n.pageNumber>r.pages?r.pages:n.pageNumber,n.pageNumber=n.pageNumber<=0?1:n.pageNumber,r.pageNumber=n.pageNumber,r.start=r.pageNumber*r.pageSize-r.pageSize+1<0?0:r.pageNumber*r.pageSize-r.pageSize+1,r.end=r.pageNumber*r.pageSize,r.pagerMsg=n.pagerMsg.replace("{start}",r.start).replace("{end}",r.end).replace("{total}",r.total);if(n.id)var i=$("#"+n.id).find(">.datagrid-pager").size();var s=t.tpl(t.getTpl("pager"),r);return i?($("#"+n.id).find(">.datagrid-pager").replaceWith(s),n.views.pager=$("#"+n.id).find(">.datagrid-pager")):n.views.pager=$(s),e?t:(t.addPagerEvent(),$.isArray(n.pagerToolBar)&&n.pagerToolBar.length&&$("#pagination-toolbar-"+n.id).append(t.getTools(n.pagerToolBar)),t.fireEvent("onPagerCreate",t,[n.views.pager]),t.methodCall("setPager"),t)},onSizeChange:function(e,t){var n=this,r=n.configs;r.width=$.dataGrid._undef(e,r.width),r.height=$.dataGrid._undef(t,r.height),r.border&&(r.width-=r.leftBorder+r.rightBorder,r.height-=r.topBorder+r.bottomBorder),$("#"+r.id).css({width:r.width,height:r.height}),$("#view_"+r.id).css({width:r.width}),n.setGrid(),n.fireEvent("onViewSizeChange",n,[])},onViewSizeChange:function(){var e=this,t=e.configs,n=t.gid,r=$(n).width(),i=$(n).height(),s=$("#view1_"+t.id),o=$("#view2_"+t.id),u=$("#view1-datagrid-header-inner-htable-"+t.id).outerWidth();s.width(u),o.width(r-parseFloat(u));var a=$("#view2-datagrid-header-inner-htable-"+t.id).outerHeight();$("#view1-datagrid-header-inner-htable-"+t.id).height(a),a=parseFloat(a)-1,$("#view1-datagrid-header-inner-"+t.id+",#view2-datagrid-header-inner-"+t.id).height(a);var f=$("#view2-datagrid-header-outer-locktable-"+t.id).outerHeight();$("#view1-datagrid-header-outer-"+t.id+",#view2-datagrid-header-outer-"+t.id).height(f);var l=parseFloat($("#view2-datagrid-header-inner-"+t.id).outerHeight())+parseFloat($("#view2-datagrid-header-outer-"+t.id).outerHeight());$("#view1-datagrid-header-"+t.id).height(l),$("#view2-datagrid-header-"+t.id).height(l);var c=o.height()-t.gheader.height()-t.gfooter.height();t.gbody.height(c),$("#view1-datagrid-body-wrap-"+t.id).height(c),e.fireEvent("onScroll",e,[])},array_sort:function(e,t,n,r){if(t==n)return e;var i=e;e=[];for(var s in i){var o=e.push(s);s==t?t=o-1:s==n&&(n=o-1)}var u=e[t];if(t>n){r||n++;for(var a=t;a>=0;a--){if(a==n){e[a]=u;break}e[a]=e[a-1]}}else if(t<n){r&&n--;for(var a=t;a<=n;a++)a==n?e[a]=u:e[a]=e[a+1]}var f=[];for(var l in e)f.push(i[e[l]]);return e=f,e},onColumnMove:function(e){var t=this,e=t.configs,n=t.getColumns(),r=0,i=0,s=e.moveToFieldPos;if(e.moveField==e.moveToField)return;if(t.inArray(e.moveField,e.lockColumns)!=-1)return;if(t.inArray(e.moveToField,e.lockColumns)!=-1)return;for(var o in n)n[o]["field"]==e.moveField&&(r=o),n[o]["field"]==e.moveToField&&(i=o);n=e.columns=t.array_sort(n,r,i,s);if(s){var r=$("#view2-datagrid-header-inner-htable-tbody-"+e.id).find("td[field='"+e.moveField+"']"),i=$("#view2-datagrid-header-inner-htable-tbody-"+e.id).find("td[field='"+e.moveToField+"']");i.before(r);for(var u in e.data)r=$("#"+e.id+"-row-"+u).find("td[field='"+e.moveField+"']"),i=$("#"+e.id+"-row-"+u).find("td[field='"+e.moveToField+"']"),i.before(r)}else{var r=$("#view2-datagrid-header-inner-htable-tbody-"+e.id).find("td[field='"+e.moveField+"']"),i=$("#view2-datagrid-header-inner-htable-tbody-"+e.id).find("td[field='"+e.moveToField+"']");i.after(r);for(var u in e.data)r=$("#"+e.id+"-row-"+u).find("td[field='"+e.moveField+"']"),i=$("#"+e.id+"-row-"+u).find("td[field='"+e.moveToField+"']"),i.after(r)}},setView:function(){var e=this,t=e.configs,n=e.tpl(e.getTpl("view1"),t),r=e.tpl(e.getTpl("view2"),t),i=t.gid;$(i).html(""),$(n).appendTo(i),$(r).appendTo(i),t.gheader=$("#view2-datagrid-header-"+t.id),t.gbody=$("#view2-datagrid-body-"+t.id),t.gfooter=$("#view2-datagrid-footer-"+t.id),t.gbody.scroll(function(){e.fireEvent("onScroll",e,[])})},getRowData:function(e,t){var n=this,r=n.configs,t=$.dataGrid._undef(t,!1),i=t?n.getData():r.data;if(!t)return i[e];var s=r.pk;for(var o in i)if(i[o][s]==e)return i[o];return!1},setRowData:function(e,t,n){var r=this,i=r.configs,s=i.data;s[e][t]=n;var o=!1;return typeof s[e]["pk"]!="undefined"&&(o=r.getRowData(s[e].pk,!0),o&&(o[t]=n)),r},getFieldValue:function(e,t){var n=this.getRowData(e);return n[t]},setFieldValue:function(e,t,n){var r=this,i=r.configs,s=i.gid,o=r.getRowData(e);if(o[t]==n)return!1;var u="#"+i.id+"-row-"+e+",#"+i.id+"-view1-row-"+e,a=$(u).find("td[field='"+t+"'] div.datagrid-cell");a.html(n).addClass("datagrid-cell-edit");var f=r.getColumnData(t,"callBack");return f!=null&&$.isFunction(f)&&f!=i.noop&&f.call(r,a,e,t,o),r.setRowData(e,t,n),r.fireEvent("onCellEdit",r,[a,e,t,o]),o},getSlectRows:function(e){var t=this,n=t.configs,r=n.gid,i=[],e=$.dataGrid._undef(e,!1);$(r).find(">.datagrid-view2 tr.datagrid-row[datagrid-row-select='1']").each(function(e){i.push($(this).attr("datagrid-row-index"))});var s=[];if(e){for(var o=0;o<i.length;o++)s.push(n.data[i[o]]);return s}return i},onLockRow:function(){var e=this,t=e.configs,n=t.lockRows;for(var r in n){if(n[r]==null)continue;e.lockRow(n[r])}},onAfterLockRow:function(e){var t=this,n=t.configs,r=t.getRowData(e);if($("#"+n.id+"-expand-row-"+e).size()){var i=$("#"+n.id+"-expand-row-"+e).is(":hidden");t.expandRow(e,r._expand),i&&t.hideExpandRow(e)}if(n.groupBy){var s=$("#view2-datagrid-body-btable-tbody-"+n.id);s.find("tr.datagrid-group-row").each(function(e){var t=$(this).attr("datagrid-group-row-id"),n=s.find("tr[datagrid-group-id='"+t+"']").first();$(this).insertBefore(n)});var o=$("#view1-datagrid-body-btable-tbody-"+n.id);o.find("tr.datagrid-group-row-view1").each(function(e){var t=$(this).attr("datagrid-group-row-id"),n=o.find("tr[datagrid-group-id='"+t+"']").first();$(this).insertBefore(n)})}t.changeExpandPos()},onLockColumn:function(){var e=this,t=e.configs,n=t.lockColumns;for(var r in n)e.lockColumn(n[r])},onAfterLockColumn:function(e){var t=this,n=t.configs,r=n.gid;$("#view2_"+n.id).find("tr.datagrid-row-expand").each(function(e){var r=$(this).attr("datagrid-expand-row-index"),i=$(this).is(":hidden"),s=t.getRowData(r);$("#"+n.id+"-expand-row-"+r).size()&&(t.expandRow(r,s._expand),i&&t.hideExpandRow(r))}),t.setExpandRowSize(),t.addGroupRow()},lockRow:function(e){var t=this,n=t.configs;t._lockRow(e)&&(t.inArray(e,n.lockRows)==-1&&n.lockRows.push(e),t.fireEvent("onAfterLockRow",t,[e]),t.fireEvent("onViewSizeChange",t,[]))},unLockRow:function(e){var t=this,n=t.configs;if(t._unLockRow(e)){for(var r in n.lockRows)n.lockRows[r]==e&&(n.lockRows[r]=null);var i=[];for(var s in n.lockRows)n.lockRows[s]!==null&&i.push(n.lockRows[s]);n.lockRows=i,t.onAfterLockRow(e),t.fireEvent("onViewSizeChange",t,[])}},unLockColumn:function(e){var t=this,n=t.configs;if(t._unLockColumn(e)){for(var r in n.lockColumns)n.lockColumns[r]==e&&(n.lockColumns[r]=null);var i=[];for(var s in n.lockColumns)n.lockColumns[s]!==null&&i.push(n.lockColumns[s]);n.lockColumns=i,t.onAfterLockColumn(e),t.fireEvent("onViewSizeChange",t,[])}},lockColumn:function(e){var t=this,n=t.configs;t._lockColumn(e)&&(t.inArray(e,n.lockColumns)==-1&&n.lockColumns.push(e),t.fireEvent("onAfterLockColumn",t,[e]),t.fireEvent("onViewSizeChange",t,[]))},_lockRow:function(e){var t=this,n=t.configs,r=n.gid,i=r,s=t.fireEvent("onBeforeLockRow",t,[e]);if(s===!1)return!1;var o=$(i).find("#"+n.id+"-row-"+e),u=$(i).find("#"+n.id+"-view1-row-"+e);return o.length?($("#view2-datagrid-header-outer-locktable-tbody-"+n.id).append(o),$("#view1-datagrid-header-outer-locktable-tbody-"+n.id).append(u),!0):!1},_unLockRow:function(e){var t=this,n=t.configs,r=n.gid,i=r,s=t.fireEvent("onUnlockRow",t,[e]);if(s===!1)return!1;var o=$(i).find("#"+n.id+"-row-"+e),u=$(i).find("#"+n.id+"-view1-row-"+e);if(!o.length)return!1;if(t.inArray(e,n.lockRows)==-1)return!1;var a=n.data;for(var f=e-1;f>=-1;f--)if(t.inArray(f,n.lockRows)==-1)break;return e=f,e>=0?(o.insertAfter("#"+n.id+"-row-"+e),u.insertAfter("#"+n.id+"-view1-row-"+e)):($("#view2-datagrid-body-btable-tbody-"+n.id).prepend(o),$("#view1-datagrid-body-btable-tbody-"+n.id).prepend(u)),!0},_getRowNumber:function(e){var t=this,n=t.configs,r=n.data,i=n.gid,s=$("#"+n.id+"-view1-row-"+e),o=!1;if(!s.size()){o=!0;var u=t.getTpl("view1_row");_d={i:e,id:n.id,rowNumbersExpand:n.rowNumbersExpand?n.rowNumbersExpand:!1,data:r[e],groupBy:n.groupBy,rowNumbersWidth:n.rowNumbersWidth,opt:n};var a=$(t.tpl(u,_d));t.bindRowEvent(!1,a),s=a}return{isNew:o,node:s}},_lockColumn:function(e){var t=this,n=t.configs,r=n.data,i=n.gid,s=i,o=t.fireEvent("onBeforeLockColumn",t,[e]);if(o===!1)return!1;var u=t.getColumnList(),e=$.isArray(e)?e:[e],a="#view1-datagrid-header-inner-htable-tbody-"+n.id,f="#view1-datagrid-header-outer-locktable-tbody-"+n.id;for(var l in e){if(e[l]==null)continue;if(t.inArray(e[l],u)==-1)continue;var c=$("#view2-datagrid-header-inner-htable-tbody-"+n.id).find(">tr.datagrid-header-row td[field='"+e[l]+"']");$(a).find(">tr.datagrid-header-row").append(c),$("#view2-datagrid-header-outer-locktable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e[l]+"']").each(function(e){var r=$(this).parent().attr("datagrid-row-index"),i=t._getRowNumber(r);i.isNew&&$("#view1-datagrid-header-outer-locktable-tbody-"+n.id).append(i.node),$(this).appendTo(i.node)}),$("#view2-datagrid-body-btable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e[l]+"']").each(function(e){var r=$(this).parent().attr("datagrid-row-index"),i=t._getRowNumber(r);i.isNew&&$("#view1-datagrid-body-btable-tbody-"+n.id).append(i.node),$(this).appendTo(i.node)}),$("#view2-datagrid-footer-btable-tbody-"+n.id).find(">tr.datagrid-footer-row td[field='"+e[l]+"']").each(function(e){var r=$(this).parent().attr("datagrid-row-index"),i=t._getRowNumber(r);i.isNew&&$("#view1-datagrid-footer-btable-tbody-"+n.id).append(i.node),$(this).appendTo(i.node)})}return!0},_unLockColumn:function(e){var t=this,n=t.configs,r=n.gid,i=r,s=t.fireEvent("onUnlockColumn",t,[e]);if(s===!1)return!1;var o=t.getColumns(),u=!1;for(var a in o)if(o[a]["field"]==e){u=!0;break}if(!u)return!1;if(t.inArray(e,n.lockColumns)==-1)return!1;var f=$("#view1-datagrid-header-inner-htable-tbody-"+n.id).find(">tr.datagrid-header-row td[field='"+e+"']"),l=$(r),c=$("#view1_"+n.id),h=$("#view2_"+n.id),p=a;for(var d in o)if(o[d]["field"]==e)break;for(d-=1;d>=-1;d--){if(d<0)break;var v=o[d].field;if(t.inArray(v,n.lockColumns)==-1)break}return p=d,p<0?f.prependTo($("#view2-datagrid-header-inner-htable-tbody-"+n.id).find(">tr.datagrid-header-row")):f.insertAfter($("#view2-datagrid-header-inner-htable-tbody-"+n.id).find(">tr.datagrid-header-row").find("td[field]").eq(p)),$("#view1-datagrid-header-outer-locktable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e+"']").each(function(e){var t=$(this).parent(),r=t.attr("datagrid-row-index"),i=$("#"+n.id+"-row-"+r);p<0?i.prepend($(this)):i.find(">td").eq(p).after($(this))}),$("#view1-datagrid-body-btable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e+"']").each(function(e){var t=$(this).parent(),r=t.attr("datagrid-row-index"),i=$("#"+n.id+"-row-"+r);p<0?i.prepend($(this)):i.find(">td").eq(p).after($(this))}),$("#view1-datagrid-footer-btable-tbody-"+n.id).find(">tr.datagrid-row td[field='"+e+"']").each(function(e){var t=$(this).parent(),r=t.attr("datagrid-row-index"),i=$("#"+n.id+"-row-"+r);p<0?i.prepend($(this)):i.find(">td").eq(p).after($(this))}),!0},getCheckBoxColumn:function(e){var t=this,n=t.configs,r=$.extend({},n._columnMetaData);return r.field="ck",r.title=n.checkBoxTitle,r._expand='<input type="checkbox">',r.hcls="datagrid-header-check",r.bcls="datagrid-cell-check",r.width=n.checkBoxWidth,r.fitColumn=n.checkBoxFit,r.align="center",r.callBack=function(e,t,n,r){var i=this;$(e).find("input:checkbox").click(function(e){this.checked?i.selectRow(t):i.unselectRow(t),e.stopPropagation()})},r},geteditColumn:function(e){var t=this,n=t.configs,r=$.extend({},n._columnMetaData),i=0,s=0;$.isArray(n.editColumn)?$.each(n.editColumn,function(e,t){$.isPlainObject(this)?(n.editColumn[e]=$.extend({},n._toolItem,n.editColumn[e]),i++):s++}):n.editColumn=[];var o="";return r.field="ed",r.title=n.editColumnTitle==""||n.editColumnTitle===!1?" ":n.editColumnTitle,r._expand=o,r.hcls="datagrid-header-edit",r.bcls="datagrid-cell-edit",r.width=i*n.editCellW+s*4+"px",r.fitColumn=n.editColumnFit,r.align="center",r.callBack=function(e,t,r,i){var s=this,o=n._toolItem,u=[],a={};for(var f in n.editColumn)$.isPlainObject(n.editColumn[f])?(a=$.extend(!0,{},o,n.editColumn[f]),a.callBack=function(e,o){var u=$(e).attr("indexid");n.editColumn[u].callBack.call(s,e,t,r,i,o)},u.push(a)):u.push(n.editColumn[f]);var l=s.getTools(u);e.append(l)},r},getColumns:function(e){var t=this,n=t.configs,r=n.columns,e=$.dataGrid._undef(e,!1);n.cacheData.columns=$.dataGrid._undef(n.cacheData.columns,r);if(e)return n.cacheData.columns;if(r.length<=0&&n.data.length>0)for(var i in n.data[0])r.push({field:i});var s=[],o=!1,u=!1;for(var i in r){r[i]=$.extend({},n._columnMetaData,r[i]);if(r[i].disabled===!0)continue;typeof r[i]["width"]=="number"&&(r[i].width+="px"),r[i].title=r[i]["title"]==""?r[i].field:r[i].title,n.checkBox!==!1&&r[i]["field"]=="ck"&&o===!1&&(r[i]=t.getCheckBoxColumn(r),o=!0),n.editColumn!==!1&&r[i]["field"]=="ed"&&u===!1&&(r[i]=t.geteditColumn(r),u=!0),s.push(r[i])}n.columns=r=s;var a=[],f=[];return n.checkBox!==!1&&o===!1&&t.getCheckBoxColumn(r)!==!1&&(a=[t.getCheckBoxColumn(r)],$.merge(a,r),r=a),n.editColumn!==!1&&u===!1&&t.geteditColumn(r)!==!1&&(f=[t.geteditColumn(r)],$.merge(r,f)),n.columns=r,n.columns},getColumnList:function(){var e=this,t=e.configs,n=t.gid,r=e.getColumns(),i=[];for(var s in r)i.push(r[s].field);return i},onDisplayField:function(){var e=this,t=e.configs,n=t.hideColumns,r=t.gid;if(n.length<=0)return;for(var i in n){if(n[i]==null)continue;e.hideColumn(n[i])}},displayColumn:function(e,t){var n=this,r=n.configs,i=r.hideColumns,s=r.gid,o=n.getColumnList();if(n.inArray(e,o)==-1)return!1;var u=t=="show"?!0:!1;if(u)for(var a in i)i[a]==e&&(i[a]=null);else n.inArray(e,i)==-1&&i.push(e);return $(s).find("td[field='"+e+"']")[t](),n.fireEvent("onViewSizeChange",n),n.setGroupRowSize(),n.setExpandRowSize(),!0},showColumn:function(e){var t=this;return t.displayColumn(e,"show")},hideColumn:function(e){var t=this;return t
.displayColumn(e,"hide")},sortColumn:function(e){var t=this,n=t.configs,r=n.gid,e=e||!1;if(e==0)return;var i=i||r+" .datagrid-view2 .datagrid-header";$(i).find("td[field='"+e+"']").find("div.datagrid-cell").click(function(e){var r=$(this).parent().attr("field");n.sortName=r;var s=t.fireEvent("onSortColumn",t,[r]);if(s===!1)return;$(this).hasClass("datagrid-sort-asc")?($(i).find("div.datagrid-cell").removeClass("datagrid-sort-asc").removeClass("datagrid-sort-desc"),$(this).removeClass("datagrid-sort-asc"),$(this).addClass("datagrid-sort-desc"),n.sortOrder="desc"):($(i).find("div.datagrid-cell").removeClass("datagrid-sort-asc").removeClass("datagrid-sort-desc"),$(this).removeClass("datagrid-sort-desc"),$(this).addClass("datagrid-sort-asc"),n.sortOrder="asc"),t.refreshData()})},setGridHeaderEvent:function(e,t){var n=this,r=n.configs,i=r.gid,s=r.columns;if(r.fitColumns){var o=$.extend({},r);o.self=n,o.stop=function(e,t){var r=n.fireEvent("onResizeColumnStop",n,[t]);if(r===!1)return r;n.cStop(t)};for(var u in s)s[u].fitColumn&&e.find("td[field='"+s[u].field+"'] div.datagrid-cell")._resize(o)}for(var u in s)s[u]["sortable"]==1?n.sortColumn(s[u].field):e.find("td[field='"+s[u].field+"'] div.datagrid-cell >.datagrid-sort-icon").hide();r.sortName&&e.find("td[field='"+r.sortName+"']  div.datagrid-cell").addClass("datagrid-sort-"+r.sortOrder.toLowerCase()),e.bind("contextmenu",function(e){var t=n.fireEvent("onHeaderContextMenu",n,[this,e]);if(t==0)return!1}),e.find(">td,td[field]").hover(function(e){$(this).addClass("datagrid-header-over"),n.fireEvent("onColumnOver",n,[this,e])},function(e){$(this).removeClass("datagrid-header-over"),n.fireEvent("onColumnOut",n,[this,e])}),n.setGridHeaderTextLimit();if(r.checkBox){var a=e.find("td[field='ck']");a.find(".datagrid-sort-icon").hide(),a.find("input:checkbox").click(function(){if(r.singleSelect)return this.checked=!1,!1;this.checked?n.selectAllRows():n.unselectAllRows()})}},setGridHeaderTextLimit:function(){var e=this,t=e.configs,n=t.gid,r=n;if(!t.textLimit)return!1;var i=t.columns;for(var s in i){if(i[s].textLimit===!1)continue;var o=$(r).find(".datagrid-header-row td[field='"+i[s].field+"']").find("div.datagrid-cell"),u=o.width(),a=o.css("fontSize"),f=e.getColumnData(i[s].field,"title");f=e.textLimit(f,u,a),o.find("span").first().html(f)}},setGridHeader:function(){var e=this,t=e.configs,n=t.gid,r=e.getColumns(),i=e.getTpl("view1_header_inner_row"),s=t.headerTpl?t.headerTpl:e.getTpl("view2_header_inner_row"),o=$("#view2-datagrid-header-inner-htable-tbody-"+t.id),u=$("#view1-datagrid-header-inner-htable-tbody-"+t.id),a=$("#view2-datagrid-header-outer-locktable-tbody-"+t.id),f=$("#view1-datagrid-header-outer-locktable-tbody-"+t.id),l=$(e.tpl(i,t)),c=$(e.tpl(s,{fields:r,opt:t}));return o.html(""),u.html(""),a.html(""),f.html(""),u.append(l),o.append(c),e.fireEvent("onHeaderCreate",e,[]),e.setGridHeaderEvent(c,l),e.methodCall("setGridHeader"),t.moveColumns&&c.find("td[field]").moveColumn(t),!0},onHeaderCreate:function(){var self=this,opt=self.configs,gid=opt.gid;if(!opt.headerTpl)return-1;var fields=opt.columns,headerBody=$("#view2-datagrid-header-inner-htable-tbody-"+opt.id),_columns=[],_thex=$.dataGrid.getToGridOptions();return headerBody.find(">tr td[field],>tr th[field],>tr td["+_thex.options_from+"],>tr th["+_thex.options_from+"]").each(function(i){var field=$(this).attr("field"),_d=$(this).attr(_thex.options_from);_d?_d=eval("({"+_d+"})"):_d={},field||(field=_d.field?_d.field:"field_"+Math.random()*99999);var _d2={};_d2.title=$(this).html();var _d3={};for(var j in fields)if(fields[j]["field"]==field){_d3=fields[j];break}$.isEmptyObject(_d3)&&(_d3.field=field),_d.width=_d.width?_d.width:$(this).width(),_d.width-=opt.padding;var _d4=$.extend(!0,{},_d,_d2,_d3);_d4.align=_d4.align?_d4.align:$(this).attr("align")?$(this).attr("align"):opt._columnMetaData.align,_d4.hcls=_d4.hcls?_d4.hcls:opt._columnMetaData.hcls;var $this=this;$(this).is("th")?($this=$('<td field="'+_d4.field+'" align="'+_d4.align+'"></td>'),$(this).replaceWith($this)):($(this).attr("field",_d4.field),$(this).attr("align",_d4.align)),$($this).html('<div class="datagrid-header-wrap" field="'+_d4.field+'"><div class="datagrid-cell '+_d4.hcls+'" style="width:'+parseFloat(_d4.width)+'px"><span>'+_d4.title+'</span><span class="datagrid-sort-icon">&nbsp;</span></div></div>'),_columns.push(_d4)}),opt.columns=_columns,headerBody.find(">tr").addClass("datagrid-header-row"),headerBody.find(">tr")},setColumnValue:function(e,t,n){var r=this,i=r.getColumns();for(var s in i)if(i[s]["field"]==e){i[s][t]=n;continue}},cStop:function(e){var t=this,n=t.configs,r=n.gid,i=$(r).find("td[field='"+e.field+"']").find("div.datagrid-cell");if(!i.size())return;var s=parseFloat(i.width());s+=e.offsetX,s=s<10?10:s,t.setColumnValue(e.field,"width",s),i.width(s),t.fireEvent("onScroll",t,[!0]),t.setGridHeaderTextLimit(),t.setGridBodyTextLimit(e.field),t.fireEvent("onViewSizeChange",t,[]),t.setGroupRowSize(),t.setExpandRowSize()},setGroupRowSize:function(){var e=this,t=e.configs,n=t.gid;if(!t.groupBy)return;var r=n+" .datagrid-view2",i=$(r).find(".datagrid-header-row").first().width();$(r).find(".datagrid-group-row td").width(i)},changeExpandPos:function(){var e=this,t=e.configs,n=t.gid;$("#view2-datagrid-body-btable-tbody-"+t.id).find(".datagrid-row-expand").each(function(t){if(!$(this).is(":hidden")){var n=$(this).attr("datagrid-expand-row-index");e.expandRow(n,"")}})},setExpandRowSize:function(){var e=this,t=e.configs,n=t.gid,r=n+" .datagrid-view2";$(r).find(".datagrid-row-expand").each(function(e){var n=$(this).attr("datagrid-expand-row-index"),r=$("#"+t.id+"-row-"+n),i=0;r.find(">td >.datagrid-cell").each(function(e){$(this).is(":hidden")||(i+=$(this).width())}),$(this).find(".datagrid-cell-expand").width(i)})},isRowHidden:function(e){var t=this,n=t.configs,r=n.gid;return e===undefined?!0:$("#"+n.id+"-row-"+e).size()&&!$("#"+n.id+"-row-"+e).is(":hidden")?!1:!0},isExpandRowShow:function(e){var t=this,n=t.configs,r=n.gid,i=n.id+"-expand-row-"+e;return $("#"+i).size()&&!$("#"+i).is(":hidden")?!0:!1},expandRow:function(e,t){var n=this,r=n.configs,i=r.gid,s=r.events,e=typeof e=="undefined"?!1:e;if(e===!1)return n;var t=typeof t=="undefined"?"":t,o=n.getRowData(e);t=n.tpl(t,o);var u=$("#"+r.id+"-row-"+e),a=$("#"+r.id+"-view1-row-"+e);if(u.size()<=0)return n;var f=r.id+"-expand-row-"+e;if($("#"+f).size())u.after($("#"+f));else{var l=0;u.find(">td >.datagrid-cell").each(function(e){$(this).is(":hidden")||(l+=$(this).width())});var c=$("<tr id='"+f+"' class='datagrid-row-expand' datagrid-expand-row-index='"+e+"'><td colspan='"+r.columns.length+"'><div class=' datagrid-cell-expand' style='overflow:hidden;width:"+l+"px'></div></td></tr>");try{$(t).size()?c.find("div.datagrid-cell-expand").append($(t).show()):c.find("div.datagrid-cell-expand").html(t)}catch(s){c.find("div.datagrid-cell-expand").html(t)}u.after(c)}var h=r.id+"-expand-view1-row-"+e;if(r.rowNumbersWidth!==!1||r.lockColumns.length){$("#"+h).remove();var p=0,d="";if(r.lockColumns.length)for(var v in r.lockColumns)r.lockColumns[v]!=null&&p++;p&&(d='<td colspan="'+p+'" class="datagrid-cell-rownumber-expand"></td>');var m=$("<tr id='"+h+"' style='overflow:hidden;'  class='datagrid-row datagrid-row-view1' datagrid-expand-row-index='"+e+"'><td class='datagrid-td-rownumber'><div class='datagrid-cell-view1-expand'></div></td>"+d+"</tr>");a.after(m);var g=$("#"+f).height();$("#"+h).height(g);if(g!=$("#"+h).height()){var g=$("#"+h).height();$("#"+h).height(g-1)}}var c=$.dataGrid._undef(c,$("#"+f)),m=$.dataGrid._undef(m,$("#"+h));n.isRowHidden(e)?(c.hide(),m.hide()):(c.show(),m.show());var g=c.height();m.css({height:g}),n.fireEvent("onExpandRow",n,[e]),n.fireEvent("onViewSizeChange",n,[])},hideExpandRow:function(e){var t=this,n=t.configs,r=n.gid,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var i=n.id+"-expand-row-"+e,s=n.id+"-expand-view1-row-"+e;$("#"+i).hide(),$("#"+s).hide(),t.fireEvent("onViewSizeChange",t,[])},destroyExpandRow:function(e){var t=this,n=t.configs,r=n.gid,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var i=n.id+"-expand-row-"+e,s=n.id+"-expand-view1-row-"+e;$("#"+i).remove(),$("#"+s).remove(),t.fireEvent("onViewSizeChange",t,[])},updateExpandRow:function(e,t){var n=this;n.destroyExpandRow(e),n.expandRow(e,t)},selectAllRows:function(){var e=this,t=e.configs,n=t.gid,r=t.events;if(t.singleSelect)return e;var i=e.fireEvent("onSelectAll",e,[]);if(i===!1)return e;for(var s in t.data)e.selectRow(s);return e},unselectAllRows:function(){var e=this,t=e.configs,n=t.gid,r=t.events,i=e.fireEvent("onUnselectAll",e,[]);if(i===!1)return e;var s=e.getSlectRows();for(var o in s)e.unselectRow(s[o]);return e},addSelectRecode:function(){},removeSelectRecode:function(){},selectRow:function(e){var t=this,n=t.configs,r=n.gid,i=n.events,s=r,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var o=t.getRowData(e),u=$("#"+n.id+"-row-"+e+",#"+n.id+"-view1-row-"+e);if(u.size()<=0)return t;var a=t.fireEvent("onSelect",t,[u,e,o]);if(a===!1)return a;u.attr("datagrid-row-select","1").addClass("datagrid-row-selected");if(n.checkBox){var f=u.find("td[field='ck'] .datagrid-cell-check input:checkbox");f.length&&(f.get(0).checked=!0)}var l=t.getSlectRows();if(l.length&&n.singleSelect)for(var c=0;c<l.length;c++){if(l[c]==e)continue;t.unselectRow(l[c])}return t},unselectRow:function(e){var t=this,n=t.configs,r=n.gid,i=n.events,s=r,e=typeof e=="undefined"?!1:e;if(e===!1)return t;var o=t.getRowData(e),u=$("#"+n.id+"-row-"+e+",#"+n.id+"-view1-row-"+e);if(u.size()<=0)return t;var a=t.fireEvent("onUnselect",t,[u,e,o]);if(a===!1)return a;u.attr("datagrid-row-select","0").removeClass("datagrid-row-selected");if(n.checkBox){var f=u.find("td[field='ck'] .datagrid-cell-check input:checkbox");f.length&&(f.get(0).checked=!1)}return t},showGroup:function(e,t){var n=this,r=n.configs,i=r.gid,s=i+" .datagrid-view2",o=i+" .datagrid-view1",t=$.dataGrid._undef(t,"show");if(typeof e=="undefined")return n;var u=$(s).find("tr[datagrid-group-id='"+e+"']"),a=$(o).find("tr[datagrid-group-id='"+e+"']");return u[t](),a[t](),u.each(function(e){var r=$(this).attr("datagrid-row-index"),i=n.getRowData(r);i._openExpand=$.dataGrid._undef(i._openExpand,!1),i._openExpand&&n.expandRow(r,i._expand),t=="hide"&&n.hideExpandRow(r)}),t=="show"?($(s).find("#"+r.id+"-group-row-"+e).find("div.datagrid-group-cell").addClass("datagrid-group-cell-select"),$(o).find("#"+r.id+"-group-view1-row-"+e).find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select")):($(s).find("#"+r.id+"-group-row-"+e).find("div.datagrid-group-cell").removeClass("datagrid-group-cell-select"),$(o).find("#"+r.id+"-group-view1-row-"+e).find("div.datagrid-group-cell-rownumber").removeClass("datagrid-group-cell-rownumber-select")),n.fireEvent("onScroll",n,[!0]),n.fireEvent("onViewSizeChange",n,[]),n},hideGroup:function(e){var t=this;return t.showGroup(e,"hide")},addGroupRow:function(e){var t=this,n=t.configs,r=n.gid,i=r+" .datagrid-view2",s=r+" .datagrid-view1";if(!n.groupBy)return!1;var e=$.dataGrid._undef(e,!1);e&&($("#view2-datagrid-body-btable-tbody-"+n.id).find("> tr").hide(),$("#view1-datagrid-body-btable-tbody-"+n.id).find("> tr").hide());var o=$(i).find(".datagrid-header-row").width(),u="";n.rowNumbersWidth!==!1&&(u="datagrid-group-cell-rownumber");var a=n.lockColumns,f=0;for(var l in a)a[l]!=null&&f++;for(var l in n.groupList){n._groupListData[l]=$.dataGrid._undef(n._groupListData[l],[]);var c=t.tpl(t.getTpl("group_row"),{gid:l,w:parseFloat(o),id:n.id,colspan:n.columns.length-f,html:n.groupList[l],num:n._groupListData[l].length}),h=$(i).find(".datagrid-body tr[datagrid-group-id='"+l+"']");h.size()<=0&&(h=$(i).find(".datagrid-header .datagrid-header-outer .datagrid-locktable tr[datagrid-group-id='"+l+"']"));var p=$(s).find("tr[datagrid-group-id='"+l+"']"),d="<tr id='"+n.id+"-group-view1-row-"+l+"' datagrid-group-row-id='"+l+"' class='datagrid-group-row-view1'><td colspan='"+(f+1)+"'><div class='"+u+"'></div></td></tr>",v=$(c),m=$(d);if($("#"+n.id+"-group-row-"+l).size())$("#"+n.id+"-group-row-"+l).replaceWith(v),$("#"+n.id+"-group-view1-row-"+l).replaceWith(m),h.first().is(":hidden")||m.find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select");else if(h.size())v.insertBefore(h.first()),m.insertBefore(p.first()),h.first().is(":hidden")||m.find("div.datagrid-group-cell-rownumber").addClass("datagrid-group-cell-rownumber-select");else{for(var g=l-1;g>=0;g--){var y=$(i).find("tr[datagrid-group-id='"+l+"']"),b=$(s).find("tr[datagrid-group-id='"+l+"']");if(y.size()){v.insertAfter(y.last()),m.insertAfter(b.first());break}}g<0&&(v.appendTo($(i).find(".datagrid-body .datagrid-btable tbody")),m.appendTo($(s).find(".datagrid-body .datagrid-btable tbody")))}var w=v.height();m.height(w),w!=m.height()&&m.height(w-1),n.groupListCallBack.call(t,v.find(".datagrid-group-cell"),n.groupList[l],n._groupListData[l])}t.setGroupEvent()},setGroupEvent:function(){var e=this,t=e.configs,n=t.gid,r=n+" .datagrid-view2",i=n+" .datagrid-view1";for(var s in t.groupList)$(r).find("#"+t.id+"-group-row-"+s).click(function(){var t=$(this).attr("datagrid-group-row-id"),n=$(this).find(".datagrid-group-cell");n.hasClass("datagrid-group-cell-select")?e.hideGroup(t):e.showGroup(t)}),$(i).find("#"+t.id+"-group-view1-row-"+s).click(function(){var t=$(this).attr("datagrid-group-row-id"),n=$(this).find(".datagrid-group-cell-rownumber");n.hasClass("datagrid-group-cell-rownumber-select")?e.hideGroup(t):e.showGroup(t)})},groupByField:function(e,t,n){var r=this,i=r.configs,s=i.gid,e=$.dataGrid._undef(e,i.groupBy),t=$.dataGrid._undef(t,i.data),n=$.dataGrid._undef(n,i.groupList);i._groupList=$.dataGrid._undef(i._groupList,i.groupList);if(e===!1)return r;var o=r.getColumns(),u=!1;for(var a=0;a<o.length;a++)if(o[a]["field"]==e){u=e;break}if(u===!1)return i.groupBy=u,r;e=u,i.groupBy=e;var f=[];if(i._groupList===!1){n=[];for(var a=0;a<t.length;a++)r.inArray(t[a][e],n)===-1&&n.push(t[a][e])}i.groupList=n;for(var l=0;l<n.length;l++){var c=[];for(var h=0;h<t.length;h++)t[h][e]==n[l]&&(t[h]._groupid_=l,c.push(t[h]));f[l]=c,c=[]}i._groupListData=f,t=[];for(var p in f)for(var d=0;d<f[p].length;d++)t.push(f[p][d]);return i.data=t,r},searchData:function(e,t,n,r){var i=this,s=i.configs,o=s.gid,e=$.dataGrid._undef(e,null);if(e==null)return i;i.clearSearch(!1);var t=$.dataGrid._undef(t,!1),u=i.getColumns();if(t!==!1){var a=!1;for(var f=0;f<u.length;f++)if(u[f]["field"]==t){a=t;break}t=a}var n=$.dataGrid._undef(n,!0);s.cacheData.searchAsync=n;if(n){var r=$.dataGrid._undef(r,s.cacheData.searchData||s.cacheData.source||s.data);s.cacheData["searched"]!=1&&(s.cacheData.searchData=s.cacheData.searchData||r,s.cacheData._url=s.url,s.cacheData._pageNumber=s.pageNumber,s.cacheData._data=s.data,s.url="",s.pageNumber=1);var l=[];for(var f=0;f<r.length;f++)if(t!==!1)r[f][t].toString().indexOf(e)!=-1&&l.push(r[f]);else for(var c=0;c<u.length;c++)if(r[f][u[c]["field"]].toString().indexOf(e)!=-1){l.push(r[f]);break}i.setGridData(l,!0),i.showGrid(function(){i.fireEvent("onSearch",i,[l]),i.setGridBody()},$.noop,!0)}else s.cacheData["searched"]!=1&&(s.cacheData._pageNumber=s.pageNumber,s.pageNumber=1),s.queryParams.searchText=e,s.queryParams.searchField=t,i.showGrid(function(){i.fireEvent("onSearch",i,[s.data]),i.setGridBody()});return s.cacheData.searched=!0,i},clearSearch:function(e){var t=this,n=t.configs,r=n.gid;if(n.cacheData.searched!==!0)return t;var e=$.dataGrid._undef(e,!0);n.cacheData.searched=!1,t.setGridData(n.cacheData.searchData),n.url=n.cacheData._url||n.url,n.pageNumber=n.cacheData._pageNumber||n.pageNumber,n.data=n.cacheData._data||n.data;try{delete n.cacheData._url}catch(i){}try{delete n.cacheData._pageNumber}catch(i){}try{delete n.cacheData.searchData}catch(i){}try{delete n.cacheData._data}catch(i){}try{delete n.queryParams.searchText}catch(i){}try{delete n.queryParams.searchField}catch(i){}return n.cacheData.searchAsync||delete n.cacheData.source,e&&(n.cacheData.searchAsync?t.refreshDataCache():t.refreshData()),delete n.cacheData.searchAsync,t},onOverRow:function(e){var t=this,n=t.configs,r=n.gid,i=$(r).find("tr[datagrid-row-index='"+e+"']");i.addClass("datagrid-row-over")},onOutRow:function(e){var t=this,n=t.configs,r=n.gid,i=$(r).find("tr[datagrid-row-index='"+e+"']");i.removeClass("datagrid-row-over")},setGridBodyTextLimit:function(e,t){var n=this,r=n.configs,i=r.gid,s=i;if(!r.textLimit)return!1;if(typeof e=="undefined"){var t=r.data,o=r.columns;for(var u in o){if(o[u].textLimit===!1)continue;var a=$(s).find(".datagrid-view2 .datagrid-body td[field='"+o[u].field+"']");a.each(function(e){var t=$(this).parent().attr("datagrid-row-index"),r=n.getRowData(t),i=$(this).find("div.datagrid-cell").html();typeof r[o[u]["field"]]=="undefined"&&n.setRowData(t,o[u].field,i),i=r[o[u].field];var s=$(this).find("div.datagrid-cell").width(),a=$(this).find("div.datagrid-cell").css("fontSize"),f=i;f=n.textLimit(f,s,a),$(this).find("div.datagrid-cell").html(f)})}}else if(arguments.length==2){var f=e,o=r.columns,l=[],c=f.attr("datagrid-row-index"),t=t,h="";for(var u in o){if(o[u].textLimit===!1)continue;h=$.dataGrid._undef(t[o[u].field],"");if(h=="")continue;var p=f.find("td[field='"+o[u].field+"'] div.datagrid-cell"),d=p.width(),v=p.css("fontSize"),m=h;m=n.textLimit(m,d,v),p.html(m)}}else{var g=n.getColumnData(e,"textLimit");if(g){var a=$(s).find(".datagrid-row td[field='"+e+"']");a.each(function(t){var r=$(this).parent().attr("datagrid-row-index"),i=n.getRowData(r),s=$(this).find("div.datagrid-cell").html();typeof i[e]=="undefined"&&n.setRowData(r,e,s),s=i[e];var o=$(this).find("div.datagrid-cell").width(),u=$(this).find("div.datagrid-cell").css("fontSize"),a=s;a=n.textLimit(a,o,u),$(this).find("div.datagrid-cell").html(a)})}}},bindRowEvent:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid;typeof e=="undefined"&&(e=!1),typeof t=="undefined"&&(t=!1);var o=r.columns;if(e)var u=e.attr("datagrid-row-index"),a=n.getRowData(u);else if(t)var u=t.attr("datagrid-row-index"),a=n.getRowData(u);e&&(e.click(function(e){var t=n.fireEvent("onClickRow",n,[this,u,a,e]);if(t===!1)return!1;var i=$(this).attr("datagrid-row-select"),s=n.getSlectRows();i=="1"?r.singleSelect?s.length==1&&s[0]!=u&&n.unselectRow(u):n.unselectRow(u):n.selectRow(u)}),e.hover(function(e){n.fireEvent("onOverRow",n,[u,e])},function(e){n.fireEvent("onOutRow",n,[u,e])}),e.dblclick(function(e){var t=n.fireEvent("onDblClickRow",n,[this,u,a,e]);if(t==0)return!1}),e.find("> td div.datagrid-cell").click(function(e){var t=$(this).parent("td").attr("field"),r=n.getFieldValue(u,t),i=n.fireEvent("onClickCell",n,[this,u,t,r,e]);if(i==0)return!1}),e.find("> td div.datagrid-cell").dblclick(function(e){var t=$(this).parent("td").attr("field"),r=n.getFieldValue(u,t),i=n.fireEvent("onDblClickCell",n,[this,u,t,r,e]);if(i==0)return!1}),e.bind("contextmenu",function(e){var t=n.fireEvent("onRowContextMenu",n,[this,u,a,e]);if(t==0)return!1}));if(e){var f=[];for(var l in o){f=o[l];if(!$.isFunction(f.callBack)||f["callBack"]==r.noop)continue;var c=e.find("td[field='"+f.field+"'] > div.datagrid-cell");f.callBack.call(n,c,u,f,a)}$.isFunction(r.rowCallBack)&&r.rowCallBack!=$.noop&&r.rowCallBack.call(n,e,u,a);if(r.rowStyler)if($.isFunction(r.rowStyler)){var h=r.rowStyler.call(n,e,u,a);typeof h=="string"&&e.addClass(h)}else typeof r.rowStyler=="string"&&e.addClass(r.rowStyler)}t&&(t.click(function(e){var t=u;n.fireEvent("onClickRowNumber",n,[t,e]),r.rowNumbers2Row!==!1&&$("#"+r.id+"-row-"+t).click()}),t.hover(function(e){n.fireEvent("onOverRow",n,[u,e])},function(e){n.fireEvent("onOutRow",n,[u,e])})),e&&n.setGridBodyTextLimit(e,a)},setRow:function(e,t){var n=this,r=n.configs,i=r.data,s=r.gid,o=n.getColumns(),u=n.getTpl("view1_row"),a=r.rowTpl?r.rowTpl:n.getTpl("view2_row"),f={},l=$("#view2-datagrid-body-btable-tbody-"+r.id),c=$("#view1-datagrid-body-btable-tbody-"+r.id),t=$.dataGrid._undef(t,$.noop),e=$.dataGrid._undef(e,0);e||(l.html(""),c.html(""));var h=r._lSize,p=1;for(var d=e;d<i.length;d++){if(p>h){setTimeout(function(){n.setRow(d,t)},r._lTime);break}p++,f={i:d,id:r.id,fields:o,rowNumbersExpand:r.rowNumbersExpand?r.rowNumbersExpand:!1,data:i[d],isCreate:r.isCreate,groupBy:r.groupBy,rowNumbersWidth:r.rowNumbersWidth,opt:r};var v=$(n.tpl(a,f));$(l).append(v),r.rowTpl&&(v.find(">td,>th").each(function(e){var t=this;$(this).is("th")?(t=$("<td field='"+o[e].field+"' align='"+o[e].align+"'><div class='datagrid-cell datagrid-cell-c1-"+o[e].field+" ' style='width:"+o[e].width+";'>"+$(this).html()+"</div></td>"),$(this).replaceWith(t)):$(this).attr("field",o[e].field).attr("align",o[e].align).html("<div class='datagrid-cell datagrid-cell-c1-"+o[e].field+" ' style='width:"+o[e].width+";'>"+$(this).html()+"</div>")}),v.addClass("datagrid-row").attr("id",r.id+"-row-"+d).attr("datagrid-row-index",d).attr("datagrid-row-select",0),typeof i[d]["_groupid_"]!="undefined"&&v.attr("datagrid-group-id",i[d]._groupid_));var m=!1;r.rowNumbersWidth!==!1&&(m=$(n.tpl(u,f)),$(c).append(m)),n.bindRowEvent(v,m)}d>=i.length?(t(),n.afterGridShow()):n.fireEvent("onShowGriding",n,[d,i])},onBeforeShowGrid:function(){var e=this,t=e.configs,n=t.gid;if(t.lockColumns.length)for(var r in t.lockColumns)if(t.lockColumns[r]!=null){e.setGridHeader();return}if(t.lockRows.length)for(var r in t.lockRows)if(t.lockRows[r]!=null){e.setGridHeader();return}},setGridBody:function(e,t){var n=this,r=n.configs,i=r.gid;n.showLoading();var e=e||i+" .datagrid-view2",s=$("#view2_"+r.id),t=t||$.noop;n.groupByField();var o=r.data;n.fireEvent("onBeforeShowGrid",n,[]),n.fireEvent("onViewSizeChange",n,[]),n.setPager();var u=r.sLeft,a=r.sTop;return n.setRow(0,function(){t(),r.sLeft=u,r.sTop=a}),n.hideLoading(),!0},afterGridShow:function(){var e=this,t=e.configs,n=t.gid;e.onFinishDone=e.onFinishDone||!1,e.onFinishDone||(e.onFinishDone=!0,e.fireEvent("onFinish",e)),e.addGroupRow(!0),e.fireEvent("onScroll",e,[!0]),e.methodCall("setGridBody"),e.fireEvent("onViewSizeChange",e,[]),e.fireEvent("onShowGrid",e,[])},setGridFooter:function(){var e=this,t=e.configs,n=t.gid;return!0},onScroll:function(e){var t=this,n=t.configs,r=n.gid,i=i||r+" .datagrid-view2",s=r+" .datagrid-view1";e=$.dataGrid._undef(e,!1),e&&(n.gbody.scrollLeft(n.sLeft),n.gbody.scrollTop(n.sTop)),n.sLeft=n.gbody._scrollLeft(),n.sTop=n.gbody._scrollTop(),$("#view2-datagrid-header-inner-"+n.id).find(">.datagrid-header-inner-wraper")._scrollLeft(n.sLeft),$("#view2-datagrid-header-outer-"+n.id).find(">.datagrid-header-outer-wraper")._scrollLeft(n.sLeft),$("#view1-datagrid-body-"+n.id)._scrollTop(n.sTop)},showGrid:function(e,t,n){var r=this,i=r.configs,s=i.gid,o=o||s+" .datagrid-view2",e=e||$.noop,t=t||$.noop,n=$.dataGrid._undef(n,!1);r.getGridData(function(){r.fireEvent("onGetData",r,[i.data]),e.apply(this,arguments)},function(){t.apply(this,arguments)},n)},refreshData:function(){var e=this.configs.events,t=this,n=t.configs,r=n.gid,i=i||r+" .datagrid-view2";t.fireEvent("onBeforeRefresh",t),t.showGrid(function(){t.setGridBody(i,function(){t.fireEvent("onRefresh",t)})})},refreshDataCache:function(){var e=this.configs.events,t=this;t.setGridBody()},clearCache:function(){var e=this.configs;e.views=[],e.isCreate=!1,this.onFinishDone=!1,e.isShow=!1,e.pki=0},clearDataCache:function(e){var t=this.configs,n=t.cacheData;t.cacheData=[];var e=$.dataGrid._undef(e,!1);return e||(t.cacheData.source=n.source,t.cacheData.columns=n.columns),this},reLoadGrid:function(e,t){var n=$.extend(!0,{},e);$.dataGrid.call(this,n)},setWH:function(e,t){var n=this;return n.fireEvent("onSizeChange",n,[e,t]),n},C:function(e,t){return typeof e=="undefined"?this.configs:typeof t=="undefined"?this.configs[e]:(this.configs[e]=t,this)},createGrid:function(e){var t=this,n=t.configs,r=n.gid,e=e||r+" .datagrid-view2";return t.setGridHeader(e),t.showGrid(function(){t.setGridBody(e)}),t.setGridFooter(e),t.methodCall("createGrid"),t},sortData:function(e,t,n){var r=this,i=r.configs,s=i.gid,e=$.dataGrid._undef(e,i.sortName);if(e=="")return r;var o=r.getColumns(),u=!1;for(var a=0;a<o.length;a++)if(o[a]["field"]==e){u=e;break}if(u===!1)return r;i.cacheData.source=i.cacheData.source||i.data;var t=$.dataGrid._undef(t,i.cacheData.source),n=$.dataGrid._undef(n,i.sortOrder),f=n=="asc"?!0:!1;return t.sort(function(t,n){return t[e]=$.dataGrid._undef(t[e],""),n[e]=$.dataGrid._undef(n[e],""),t[e]>=n[e]?f?1:-1:f?-1:1}),t},onDataChange:function(e){var t=this,n=t.configs;t.refreshData()},addData:function(e){var t=this,n=t.configs,r=t.getAsync(),i=$.dataGrid._undef(i,[]);i=$.isPlainObject(i)?[i]:i;var s=n.pk;if(r){var o=t.getData();for(var u=0;u<i.length;u++){var e=i[u];e[s]=$.dataGrid._undef(e[s],t.unique()),o.push(e)}t.fireEvent("onAdd",t,[i,!0]),t.fireEvent("onDataChange",t,[i])}else t.fireEvent("onAjaxAdd",t,[i,function(){t.onDataChange(i)}])},updateData:function(e){var t=this,n=t.configs,r=t.getAsync(),e=$.dataGrid._undef(e,[]);e=$.isPlainObject(e)?[e]:e;var i=n.pk,s=!1;if(r){for(var o=0;o<e.length;o++){var u=e[o];if(!$.isPlainObject(u))continue;s=$.dataGrid._undef(u[i],!1);if(s===!1)continue;var a=t.getData();for(var f in a)if(a[f][i]==u[i]){a[f]=u;break}}t.fireEvent("onUpdate",t,[e,!0]),t.fireEvent("onDataChange",t,[e])}else t.fireEvent("onAjaxUpdate",t,[e,function(){t.onDataChange(e)}])},deleteData:function(e){var t=this,n=t.configs,r=t.getAsync(),e=$.dataGrid._undef(e,[]);e=$.isPlainObject(e)?[e]:e;var i=n.pk,s=!1;if(r){var o=t.getData();for(var u=0;u<e.length;u++){var a=e[u];if(!$.isPlainObject(a))continue;s=$.dataGrid._undef(a[i],!1);if(s===!1)continue;for(var f in o)if(o[f][i]==a[i])break;var l=[];for(var c in o){if(f==c)continue;l.push(o[c])}o=l}t.fireEvent("onDelete",t,[e,!0]),t.fireEvent("onDataChange",t,[e])}else t.fireEvent("onAjaxDelete",t,[e,function(){t.onDataChange(e)}])},getAsync:function(){var e=this,t=e.configs,n=t.gid;return t.url==""||t.url===!1?!0:!1},setGridData:function(e,t,n){var r=this,i=r.configs,s=i.gid,t=$.dataGrid._undef(t,!1),n=$.dataGrid._undef(n,!1);t==0&&(t=r.getAsync()),t?i.cacheData.source=e:i.data=e,i.pk=="_pk"&&(i.pk="",r.fireEvent("onSetPk",r,[e])),n&&(t?r.showGrid(function(){r.setGridBody()},$.noop,!0):r.refreshDataCache())},onLoadSuccess:function(e,t){var n=this,r=n.configs,i=r.gid;r.data=e.rows,r.total=e.total,e.columns&&(r.columns=e.columns,n.setGridHeader())},onLoadError:function(e,t,n){var r=this,i=r.configs,s=i.gid;r.showLoading(e),setTimeout(function(){r.hideLoading(),r.refreshDataCache()},2e3)},getGridData:function(e,t,n){var r=this,i=r.configs,s=i.gid,e=e||$.noop,t=t||$.noop,o=s+" .datagrid-view2",n=$.dataGrid._undef(n,!1);n==0&&(n=r.getAsync()),r.methodCall("getGridData");if(n){i.cacheData.source=i.cacheData.source||i.data,r.fireEvent("onSetPk",r,[i.cacheData.source]),i.sortName!=""&&(i.cacheData.source=r.sortData()),i.total=i.cacheData.source.length;var u=(i.pageNumber-1)*i.pageSize,a=i.pageSize*i.pageNumber;a=a>i.total?i.total:a;var f=[];for(var l=u;l<a;l++)f.push(i.cacheData.source[l]);i.data=f,e.call(r,o);return}i.queryParams.pageNumber=i.pageNumber,i.queryParams.pageSize=i.pageSize,i.sortName!=""&&(i.queryParams.sortName=i.sortName,i.queryParams.sortOrder=i.sortOrder);var c=r.configs.events;$.ajax({url:i.url,type:i.method,cache:i.cache,dataType:i.dataType,data:i.queryParams,beforeSend:function(){r.fireEvent("onBeforeLoad",r,[i.queryParams]),r.showLoading()},success:function(t){r.hideLoading(),r.fireEvent("onLoadSuccess",r,[t,e]),e.call(r,o)},error:function(e){r.fireEvent("onLoadError",r,[e.responseText,t,e]),t.call(r,e.responseText)}})},setPk:function(e){var t=this,n=t.configs;if(n.pk!="")return;n.pki=1,n.pk="_pk",$.each(e,function(t,r){e[t][n.pk]=n.pki++})},show:function(){var e=this,t=e.configs,n=t.views,r=$("#"+t.id);if(t.isShow)return;t.isShow=!0;for(var i in n)r.append(n[i]);e.setGrid(),e.setView(),e.createGrid(),e.methodCall("show")}}),$.fn._scrollLeft=function(e){return e==undefined?this.scrollLeft():this.each(function(){$(this).css("marginLeft",e*-1)})},$.fn._scrollTop=function(e){return e==undefined?this.scrollTop():this.each(function(){$(this).css("marginTop",e*-1)})},$.fn.datagrid=function(e){if(this.size()<=0)return!1;var t=[];return this.each(function(n){var r=$(this),i=$.extend(!0,{},e);i.selector=r.selector,i.helper=r,i.width=$.dataGrid._undef(i.width,r.width()),i.height=$.dataGrid._undef(i.height,r.height()),r.data("metaData",$.extend(!0,{},i,{}));var s=new $.dataGrid(i);r.data("datagrid",s),t.push(s)}),this.size()==1?this.data("datagrid"):t},$.fn.dataGrid=$.fn.datagrid,$.fn.extGrid=$.fn.datagrid,$.fn.extgrid=$.fn.datagrid,$.fn.togrid=function(cfg,_cfg){cfg=$.dataGrid._undef(cfg,{});var _cfg=$.dataGrid.getToGridOptions(_cfg),list=[];return this.each(function(i){$(this).css("display","block");if($(this).attr(_cfg.options_from)){var opt="{"+$(this).attr(_cfg.options_from)+"}";opt=eval("("+opt+")")}else var opt={};var wh={width:$(this).outerWidth(),height:$(this).outerHeight(),title:$(this).attr("title")},columns=[];$(this).find(_cfg.columns_from).size()||(_cfg.columns_from="tr:first-child td,tr:first-child th");var thead=$(this).find(_cfg.columns_from),avg_w=0;if(cfg.border!==!1||opt.border!==!1)avg_w=2/thead.size();thead.each(function(i){if($(this).attr("ignore")!=undefined)return;if($(this).attr("field"))var column_a={field:$(this).attr("field")};else var column_a={};if($(this).attr(_cfg.options_from)){var column_b="{"+$(this).attr(_cfg.options_from)+"}";column_b=eval("("+column_b+")")}else var column_b={};var column=$.extend({},column_b,column_a);column.title=$(this).html(),column.field=column.field?column.field:"field_"+Math.random()*99999,column.width=column.width?column.width:$(this).outerWidth()-1-1,$(this).attr("align")&&(column.align=$(this).attr("align")),column.field=="ck"&&(opt.checkBox=!0),column.field=="ed"&&(wh.editColumn=!0),columns.push(column)}),$(this).find(_cfg.columns_from).parent("tr").remove(),$(this).find(_cfg.data_from).size()||(_cfg.data_from="tr"),opt.columns=columns,opt=$.extend(!0,wh,opt,cfg);if(!opt.url){var data=[];$(this).find(_cfg.data_from).each(function(e){var t={};$(this).find(">td,>th").each(function(e){var n=$(this).html();$(this).attr("field")?t[$(this).attr("field")]=n:opt.columns[e].field&&(t[opt.columns[e].field]=n)}),data.push(t)}),opt.data=data}opt.helper=$("<div id='"+($(this).attr("id")?$(this).attr("id"):"")+"' class='datagrid "+$(this).attr("class")+"'></div>"),$(this).after(opt.helper).remove();var grid=new $.dataGrid(opt);opt.helper.data("metaData",opt),opt.helper.data("datagrid",grid),list.push(grid)}),this.size()==1?list[0]:list},$.fn.toGrid=$.fn.togrid,$.fn._resize=function(e){function n(e,t){$(document.body).css("cursor","col-resize"),$(document.body).css("-moz-user-select","none"),$(document.body).attr("unselectable","on"),t.gheader.find(".datagrid-header-inner").css("cursor","col-resize"),t.gheader.find("div.datagrid-cell").css("cursor","col-resize");var n=$("<div class='datagrid-resize'></div>"),s="#view_"+t.id;$(s).append(n);var o=$(this).offset().left-$(s).offset().left,u=$(s).height(),a=$(this).width();o=parseFloat(o)+parseFloat(a),n.css({position:"absolute",borderLeft:"1px solid #aac5e7",top:0,zIndex:9999,height:parseFloat(u),left:o}),t.line=n,t.x=e.clientX,t.left=o,t.offsetX=0,$(document.body).bind("selectstart",function(e){return!1}),$(document).bind("mousemove",function(e){var n=t.self.fireEvent("onResizeColumn",t.self,[t,e]);if(n===!1)return;r(e,t)}),$(document).bind("mouseup",function(e){var n=t.stop(e,t);i(e,t)})}function r(e,t){var n=e.clientX,r=t.left+(n-t.x);t.offsetX=n-t.x,t.line.css({left:r})}function i(e,t){var n="#view_"+t.id;$(document).unbind("mousemove"),$(document).unbind("mouseup"),$(document.body).unbind("selectstart"),$(document.body).css("cursor","default"),$(document.body).removeAttr("unselectable"),t.gheader.find(".datagrid-header-inner").css("cursor","default"),t.gheader.find("div.datagrid-cell").css("cursor","default"),$(t.line).remove()}var e=e||{},e=$.extend({},e),t=this;t.each(function(t){$("<div class='datagrid_resize'></div>").appendTo($(this).parent()).bind("mousedown",function(t){e.field=$(this).parent().attr("field");var r=e.self.fireEvent("onResizeColumnStart",e.self,[this,e,t]);if(r===!1)return;n.call(this,t,e),t.preventDefault(),t.stopPropagation()})})},$.fn.moveColumn=function(e){function r(t){n=!0,e.moveField=$(this).attr("field");var r=$('<div class="column-move" id="'+e.id+'_move" style="position:absolute;z-index:9999;">'+$(".datagrid-cell",this).html()+"</div>").appendTo("#"+e.id),i=$('<div class="column-move-line" id="'+e.id+'_line" style="position:absolute;height:'+$(this).outerHeight()+'px;"></div>').appendTo("#"+e.id),s=$("#"+e.id).offset();r.css({left:t.pageX-s.left+10,top:t.pageY-s.top+10}),$(document.body).bind("mousemove.move",function(e){r.css({left:e.pageX-s.left+10,top:e.pageY-s.top+10
}),e.preventDefault(),e.stopPropagation()}),$(document.body).bind("mouseup.move",function(t){n=!1,r.remove(),i.remove(),$(document.body).unbind("mousemove.move mouseup.move"),e.self.fireEvent("onColumnMove",e.self,[e]),t.preventDefault(),t.stopPropagation()})}var t=this,n=!1;t.bind("mousedown.move",function(t){var n=this,i=setTimeout(function(){r.call(n,t)},e.moveColumnTm);$(document.body).bind("mouseup.wt",function(e){clearTimeout(i),$(document.body).unbind("mouseup.wt")}),t.preventDefault(),t.stopPropagation()}),t.bind("mousemove.h",function(t){if(n==0)return;var r=$("#"+e.id).offset(),i=r.top,s=r.left,o=$(this).outerWidth(),u=$(this).height()-2,a=$(this).offset().top-i,f=$(this).offset().left-s-2,l=t.pageX,c=l-$(this).offset().left;e.moveToField=$(this).attr("field");var h=e.self.fireEvent("onColumnMoving",e.self,[e]);if(h===!1)return;c<=o/2?($("#"+e.id+"_line").css({left:f,top:a,height:u}),e.moveToFieldPos=1):($("#"+e.id+"_line").css({left:f+o,top:a,height:u}),e.moveToFieldPos=0)})}})(jQuery)